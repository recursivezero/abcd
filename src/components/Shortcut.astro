---
import "@/assets/styles/shortcut.css";
---

<div class="container__shortcut">
  <button id="help-popover-btn" style="display:none"></button>
  <div id="help-popup" class="help-popup">
    <div class="help-menu">
      <div class="help-menu-header">
        <h2>Keyboard Shortcuts</h2>
        <button id="close-help" class="close-button" aria-label="Close help menu">Ã—</button>
      </div>
      <div class="help-menu-content grid">
        <div class="shortcut-section">
          <h3>Repositories</h3>
          <ul>
            <li><span class="desc">Open in codespace</span> <span class="keys"><kbd>Ctrl</kbd>+<kbd>.</kbd></span></li>
            <li><span class="desc">Open in github.dev editor</span> <span class="keys"><kbd>Alt</kbd>+<kbd>.</kbd></span></li>
            <li><span class="desc">Go to Code</span> <span class="keys"><kbd>G</kbd> <kbd>C</kbd></span></li>
            <li><span class="desc">Go to Issues</span> <span class="keys"><kbd>G</kbd> <kbd>I</kbd></span></li>
            <li><span class="desc">Go to Pull Requests</span> <span class="keys"><kbd>G</kbd> <kbd>P</kbd></span></li>
            <li><span class="desc">Go to Actions</span> <span class="keys"><kbd>G</kbd> <kbd>A</kbd></span></li>
            <li><span class="desc">Go to Projects</span> <span class="keys"><kbd>G</kbd> <kbd>B</kbd></span></li>
            <li><span class="desc">Go to Wiki</span> <span class="keys"><kbd>G</kbd> <kbd>W</kbd></span></li>
            <li><span class="desc">Go to Discussions</span> <span class="keys"><kbd>G</kbd> <kbd>G</kbd></span></li>
          </ul>
        </div>
        <div class="shortcut-section">
          <h3>Site-wide shortcuts</h3>
          <ul>
            <li><span class="desc">Open home page</span> <span class="keys"><kbd>H</kbd> or <kbd>/</kbd></span></li>
            <li><span class="desc">Go to about</span> <span class="keys"><kbd>G</kbd> + <kbd>H</kbd></span></li>
            <li><span class="desc">Go to dashboard</span> <span class="keys"><kbd>G</kbd> <kbd>D</kbd></span></li>
            <li><span class="desc">Go to your issues</span> <span class="keys"><kbd>G</kbd> <kbd>I</kbd></span></li>
            <li><span class="desc">Go to your pull requests</span> <span class="keys"><kbd>G</kbd> <kbd>P</kbd></span></li>
            <li><span class="desc">Bring up this help dialog</span> <span class="keys"><kbd>?</kbd></span></li>
            <li><span class="desc">Move selection down</span> <span class="keys"><kbd>J</kbd></span></li>
            <li><span class="desc">Move selection up</span> <span class="keys"><kbd>K</kbd></span></li>
            <li><span class="desc">Toggle selection</span> <span class="keys"><kbd>X</kbd></span></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const popup = document.getElementById('help-popup');
    const openBtn = document.getElementById('help-popover-btn');
    const closeBtn = document.getElementById('close-help');
    let gPressed = false;

    function openPopup() {
      popup?.classList.add('is-open');
    }
    function closePopup() {
      popup?.classList.remove('is-open');
    }

    openBtn?.addEventListener('click', openPopup);
    closeBtn?.addEventListener('click', closePopup);

    document.addEventListener('keydown', function(e) {
      // Open popup on "?" key
      if (e.key === '?' && !['INPUT', 'TEXTAREA'].includes((document.activeElement?.tagName || ''))) {
        e.preventDefault();
        openPopup();
      }
      if ((e.key === '/') || (e.key === 'h' || e.key === 'H') && !['INPUT', 'TEXTAREA'].includes((document.activeElement?.tagName || ''))) {
        e.preventDefault();
        window.location.href = '/';
      }
      // Close popup on ESC
      if (e.key === 'Escape' && popup?.classList.contains('is-open')) {
        closePopup();
      }
      // G + H shortcut
      if (!['INPUT', 'TEXTAREA'].includes((document.activeElement?.tagName || ''))) {
        if (gPressed && (e.key === 'h' || e.key === 'H')) {
          e.preventDefault();
          window.location.href = '/about';
          gPressed = false;
          return;
        }
        if (e.key === 'g' || e.key === 'G') {
          gPressed = true;
          setTimeout(() => { gPressed = false; }, 1000);
          return;
        }
      }
    });
  });
</script>