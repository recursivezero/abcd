---
import BaseLayout from "@/layouts/Base";
import "@/assets/styles/barahkhadi/index.css";

import { hindiConsonants } from "@/utils/common";
import { matras } from "@/utils/common";
import Help from "@/components/Help.astro";

const consonants = [
  hindiConsonants.slice(0, 5), // ‡§ï, ‡§ñ, ‡§ó, ‡§ò, ‡§ô
  hindiConsonants.slice(5, 10), // ‡§ö, ‡§õ, ‡§ú, ‡§ù, ‡§û
  hindiConsonants.slice(10, 15), // ‡§ü, ‡§†, ‡§°, ‡§¢, ‡§£
  hindiConsonants.slice(15, 20), // ‡§§, ‡§•, ‡§¶, ‡§ß, ‡§®
  hindiConsonants.slice(20, 25), // ‡§™, ‡§´, ‡§¨, ‡§≠, ‡§Æ
  hindiConsonants.slice(25, 29), // ‡§Ø, ‡§∞, ‡§≤, ‡§µ
  hindiConsonants.slice(29, 33) // ‡§∂, ‡§∑, ‡§∏, ‡§π
];
---

<BaseLayout meta={{ title: "Barahkhadi" }}>
  <Fragment slot="header-left">
    <Help title="Barahkhadi" description="This page displays the Hindi consonants and their variations." />
  </Fragment>
  <div class="container__barahkhadi">
    <div class="consonants-rows">
      {
        consonants.map((row) => (
          <div class="consonant-row">
            <div class="consonants-grid">
              {row.map((consonant) => (
                <div class="consonant-card" data-active="false">
                  <a href={`/barahkhadi/${consonant}`} class="consonant-content">
                    <span class="consonant">{consonant}</span>
                  </a>
                  <button class="quick-view-btn">üîç</button>
                  <div class="barahkhadi-popover">
                    <div class="variations-grid">
                      {Object.values(matras).map((matra) => (
                        <div class="variation">{consonant + matra}</div>
                      ))}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))
      }
    </div>
  </div>
</BaseLayout>

<script>
  document.querySelectorAll(".quick-view-btn").forEach((button) => {
    button.addEventListener("click", (e) => {
      // Close all other open popovers
      document.querySelectorAll('.consonant-card[data-active="true"]').forEach((card) => {
        if (card !== (e.currentTarget as HTMLElement).closest(".consonant-card")) {
          // Don't reset current card
          const btn = card.querySelector(".quick-view-btn") as HTMLElement;
          card.setAttribute("data-active", "false");
          btn.textContent = "üîç";
        }
      });

      // Toggle current popover
      const card = (e.currentTarget as HTMLElement).closest(".consonant-card") as HTMLElement;
      const isActive = card.getAttribute("data-active") === "true";
      const newState = !isActive;
      card.setAttribute("data-active", String(newState));
      (e.currentTarget as HTMLElement).textContent = newState ? "‚úñÔ∏è" : "üîç";
    });
  });
</script>
